!function(t){t.module("daveawb.angularModels",[])}(angular),function(){function t(){return{object_path:e,lodash_methods:r,extender:i,urlError:s}}function e(t,e){e=e.replace(/^\./,"");for(var n=e.split("."),r=0,i=n.length;i>r;++r){var s=n[r];if(!(s in t))return;t=t[s]}return t}function n(t,e,n){switch(t){case 1:return function(){return _[e](this[n])};case 2:return function(t){return _[e](this[n],t)};case 3:return function(t,r){return _[e](this[n],u(t,this),r)};case 4:return function(t,r,i){return _[e](this[n],u(t,this),r,i)};default:return function(){var t=[].slice.call(arguments);return t.unshift(this[n]),_[e].apply(_,t)}}}function r(t,e,r){_.each(e,function(e,i){_[i]&&(t.prototype[i]=n(e,i,r))})}function i(t,e){var n,r=this;n=t&&_.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},_.extend(n,r,e);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,t&&_.extend(n.prototype,t),n.__super__=r.prototype,n}function s(){throw new Error("A URL must be defined on a collection or a urlRoot on a model.")}angular.module("daveawb.angularModels").factory("daveawbHelpers",t),t.$inject=[];var u=function(t,e){return _.isFunction(t)?t:_.isObject(t)&&!e._isModel(t)?a(t):_.isString(t)?function(e){return e.get(t)}:t},a=function(t){var e=_.matches(t);return function(t){return e(t.attributes)}}}(),function(t){function e(t,e){return r.extend=t.extender,r.http=e,r.helpers=t,t.lodash_methods(r,n,"models"),r}t.module("daveawb.angularModels").factory("daveawbCollection",e);var n={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,includes:2,contains:2,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};e.$inject=["daveawbHelpers","$http"];var r=function(t,e){e||(e={}),e.model&&(this.model=e.model),this.models=[],this._byId={},this.set(t,e)};_.extend(r.prototype,{model:null,set:function(t,e){var n=this,r=this.model,i=!_.isArray(t);return e||(e={}),t=i?t?[t]:[]:t.slice(),_.each(t,function(t){var i=n.get(t);if(i)i.set(t,e);else{var s=new r(t,_.extend({collection:n},e));n.models.push(s),s.isNew()?n._byId[s.uid]=s:n._byId[n.modelId(s)]=s}}),this},get:function(t){if(null==t)return void 0;var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.uid]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},pluck:function(t){return this.map(function(e){return e.attributes[t]})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_isModel:function(t){return t instanceof this.model},fetch:function(t){var e=this,n=this.url;return n||r.helpers.urlError(),t&&(n=n.split("/"),n.push(t),n=n.join("/")),r.http.get(n).then(function(t){t=e.parse(t);var n=e.path?r.helpers.object_path(t.data,e.path):t.data;return e.set(n),e})},parse:function(t){return t}})}(angular),function(t){function e(t,e,i){return n.extend=t.extender,n.helpers=t,n.$http=e,t.lodash_methods(n,r,"attributes"),n}function n(t,e){var n=t||{};e||(e={}),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),this.isGuarded=_.isArray(this.guarded),this.isFillable=!this.isGuarded&&_.isArray(this.fillable),n=_.defaults({},n,_.result(this,"defaults")),this.set(n,e)}t.module("daveawb.angularModels").service("daveawbModel",e);var r={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};e.$inject=["daveawbHelpers","daveawbSync","$http"],_.extend(n.prototype,{cast:{},changed:[],uid:null,defaults:{},fillable:null,guarded:null,getters:{},idAttribute:"id",setters:{},set:function(t,e,n){var r;"object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={});var i=n.unset,s=this.attributes,u=_.keys(r),a=[];this._previousAttributes=_.clone(this.attributes),this.isGuarded?u=_.difference(u,this.guarded):this.isFillable&&(u=_.intersection(this.fillable,u)),r[this.idAttribute]&&(this[this.idAttribute]=r[this.idAttribute]);for(var o in r)if(-1!==u.indexOf(o)){if(a.push(o),this.setters[o]&&"function"==typeof this.setters[o]&&(r[o]=this.setters[o](r[o])),this.cast[o]){var c="castTo"+this.cast[o];"function"==typeof this[c]&&(r[o]=this[c](r[o]))}i?delete s[o]:s[o]=r[o]}return this.uid?this.changed=this.changed.concat(a):this.uid=_.uniqueId("u"),this},get:function(t){var e=this.getters[t];return e&&"function"==typeof e?e(this.attributes[t]):this.attributes[t]},parse:function(t,e){return t},sync:function(){return n.$http.apply(this,arguments)},fetch:function(t){t=_.extend({parse:!0},t);var e=this,r=t.success||_.noop();return this.sync("read",this,t).then(function(i){var s=e.path||"data",u=t.parse?e.parse(n.helpers.object_path(i,s),t):i;return e.set(u,t)?(r instanceof Function&&r.call(t.context,e,i,t),e):!1})},has:function(t){return null!=this.get(t)},hasChanged:function(t){var e=this.changed;return-1!==e.indexOf(t)},isNew:function(){return!this.attributes[this.idAttribute]},unset:function(t,e){var n=t;return"object"!=typeof n&&((n={})[t]=void 0),this.set(n,_.extend({},e,{unset:!0}))},escape:function(t){return _.escape(this.get(t))},toJson:function(){return JSON.stringify(_.clone(this.attributes))},toObject:function(){return this.attributes},url:function(){var t=_.result(this,"urlRoot")||_.result(this.collection,"url")||n.helpers.urlError();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},castToInt:function(t){return parseInt(t,10)},castToString:function(t){return t.toString()},castToBool:function(t){return"false"===t||"0"===t?!1:!!t},castToDate:function(t){return new Date(t)}})}(angular),function(t,e){t.module("daveawb.angularModels").factory("daveawbSync",["$http","daveawbHelpers",e])}(angular,function(t,e){return function(n,r,i){var s={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};i||(i={});var u=s[n],a={method:u,dataType:"json"};return a.url=_.result(r,"url")||e.urlError(),t(_.extend(a,i))}});